<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PDF para Imagens - Fundo VÃ­deo</title>
<style>
  /* Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body, html {
    margin:0; padding:0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    background: #000;
    color: #d90550;
    display: flex;
    flex-direction: column;
  }

  /* VÃ­deo fundo */
  #bg-video {
    position: fixed;
    top:0; left:0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -2;
    filter: brightness(0.3) contrast(1.2);
  }
  #bg-overlay {
    position: fixed;
    top:0; left:0;
    width: 100vw; height: 100vh;
    background-color: rgba(0,0,0,0.75);
    z-index: -1;
  }

  header {
    position: sticky;
    top: 0;
    background: rgba(217, 5, 80, 0.85);
    padding: 12px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 2px 10px rgba(217,5,80,0.8);
    z-index: 10;
  }
  header .logo {
    width: 4rem;
    height: 4rem;
    flex-shrink: 0;
  }
  header .logo img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    filter: drop-shadow(0 0 8px #d90550);
  }
  header h1 {
    margin: 0;
    font-weight: 700;
    font-size: 1.8rem;
    color: #fff;
    text-shadow: 0 0 12px #d90550cc;
  }

  main {
    flex: 1;
    padding: 20px 30px;
    max-width: 1200px;
    margin: auto;
    width: 100%;
  }

  input[type="file"] {
    display: block;
    margin: 0 auto 30px auto;
    padding: 14px 20px;
    width: 100%;
    max-width: 480px;
    border: 3px dashed #d90550;
    border-radius: 10px;
    background: rgba(217, 5, 80, 0.15);
    color: #d90550;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s ease, border-color 0.3s ease;
    text-align: center;
  }
  input[type="file"]:hover {
    background: rgba(217, 5, 80, 0.3);
    border-color: #a40037;
  }

  #pdfs-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
  }

  .pdf-block {
    background: rgba(217, 5, 80, 0.1);
    padding: 16px;
    border-radius: 16px;
    box-shadow: 0 0 10px #d90550aa;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .pdf-block:hover {
    transform: translateY(-8px);
    box-shadow: 0 0 20px #d90550dd;
  }

  .pdf-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 12px;
    color: #d90550;
    text-shadow: 0 0 6px #d90550bb;
  }

  .pages-container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
  }

  canvas {
    width: 120px;
    height: 180px;
    border-radius: 10px;
    border: 2px solid #d90550aa;
    box-shadow: 0 4px 10px #d90550aa;
    cursor: pointer;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
  }
  canvas:hover {
    transform: scale(1.1);
    box-shadow: 0 0 18px #d90550ee;
  }

  button#download-zip {
    display: block;
    margin: 40px auto 20px auto;
    background: linear-gradient(90deg,#d90550,#700027);
    color: #fff;
    font-weight: 700;
    font-size: 1.2rem;
    padding: 16px 48px;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    box-shadow: 0 6px 20px #d90550cc;
    transition: background 0.4s ease;
  }
  button#download-zip:hover:not(:disabled) {
    background: linear-gradient(90deg,#700027,#d90550);
  }
  button#download-zip:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    box-shadow: none;
  }

  footer {
    text-align: center;
    font-size: 0.9rem;
    color: #d90550cc;
    padding: 16px 10px;
    background: rgba(0,0,0,0.2);
    font-weight: 600;
    letter-spacing: 0.06em;
    user-select: none;
  }

  /* Modal preview */
  #modal {
    position: fixed;
    top:0; left:0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 9999;
  }
  #modal.show {
    opacity: 1;
    pointer-events: auto;
  }
  #modal img {
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 12px;
    box-shadow: 0 0 40px #d90550cc;
  }

  @media (max-width: 1080px) {
    #pdfs-container {
      grid-template-columns: repeat(3, 1fr);
    }
    canvas {
      width: 100px;
      height: 150px;
    }
  }
  @media (max-width: 720px) {
    #pdfs-container {
      grid-template-columns: repeat(2, 1fr);
    }
    canvas {
      width: 90px;
      height: 135px;
    }
  }
  @media (max-width: 480px) {
    #pdfs-container {
      grid-template-columns: 1fr;
    }
    canvas {
      width: 100%;
      height: auto;
      aspect-ratio: 2 / 3;
    }
  }
</style>
</head>
<body>

<video id="bg-video" autoplay muted loop playsinline></video>
<div id="bg-overlay"></div>

<header>
  <div class="logo">
    <img src="https://cdn-icons-png.flaticon.com/512/936/936398.png" alt="Logo" />
  </div>
  <h1>PDF â†’ Imagens Top</h1>
</header>

<main>
  <input type="file" id="file-input" accept="application/pdf" multiple />
  <div id="pdfs-container"></div>
  <button id="download-zip" disabled>Baixar tudo (.zip)</button>
</main>

<footer>
  Feito com ðŸ’™ pela Zero Two e maninho
</footer>

<!-- Modal preview -->
<div id="modal" aria-hidden="true" tabindex="-1">
  <img src="" alt="Preview da imagem" />
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.0/hls.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
  // VÃ­deo fundo HLS
  const video = document.getElementById('bg-video');
  const videoSrc = 'https://v1.pinimg.com/videos/iht/hls/0b/ae/fb/0baefb707b7ba414c28aaeec48e7b3bb_720w.m3u8';

  if(Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play().catch(e => console.log('Erro ao iniciar vÃ­deo:', e));
    });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
    video.addEventListener('loadedmetadata', () => {
      video.play().catch(e => console.log('Erro ao iniciar vÃ­deo:', e));
    });
  } else {
    console.log('HLS nÃ£o suportado nesse navegador');
  }

  // PDF para imagens
  const fileInput = document.getElementById('file-input');
  const container = document.getElementById('pdfs-container');
  const downloadBtn = document.getElementById('download-zip');
  const modal = document.getElementById('modal');
  const modalImg = modal.querySelector('img');

  let allImages = [];

  fileInput.addEventListener('change', async (e) => {
    const files = Array.from(e.target.files);
    if (!files.length) return;

    allImages = [];
    container.innerHTML = '';
    downloadBtn.disabled = true;

    for (const file of files) {
      const name = file.name;
      const chapterMatch = name.match(/(\d+)/);
      if (!chapterMatch) {
        alert(`Arquivo "${name}" nÃ£o tem nÃºmero de capÃ­tulo no nome.`);
        continue;
      }
      const chapter = chapterMatch[1];

      const block = document.createElement('div');
      block.className = 'pdf-block';

      const title = document.createElement('h2');
      title.className = 'pdf-title';
      title.textContent = `CapÃ­tulo ${chapter} - ${name}`;
      block.appendChild(title);

      const pagesDiv = document.createElement('div');
      pagesDiv.className = 'pages-container';
      block.appendChild(pagesDiv);
      container.appendChild(block);

      const buffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument(new Uint8Array(buffer)).promise;

      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const viewport = page.getViewport({ scale: 1 });
        const scale = Math.min(120 / viewport.width, 180 / viewport.height);
        const view = page.getViewport({ scale });

        const canvas = document.createElement('canvas');
        canvas.width = view.width;
        canvas.height = view.height;

        const ctx = canvas.getContext('2d');
        await page.render({ canvasContext: ctx, viewport: view }).promise;
        pagesDiv.appendChild(canvas);

        const imgData = canvas.toDataURL('image/png');
        allImages.push({
          chapter: chapter,
          page: i,
          dataUrl: imgData
        });

        // Abrir modal ao clicar
        canvas.addEventListener('click', () => {
          modalImg.src = imgData;
          modal.classList.add('show');
          modal.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        });
      }
    }

    if (allImages.length) {
      downloadBtn.disabled = false;
    }
  });

  downloadBtn.addEventListener('click', () => {
    const zip = new JSZip();
    allImages.forEach(img => {
      const base64 = img.dataUrl.split(',')[1];
      const name = `${img.chapter}x${img.page}.png`;
      zip.file(name, base64, { base64: true });
    });

    zip.generateAsync({ type: "blob" }).then(content => {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(content);
      a.download = 'capitulos_imagens.zip';
      a.click();
      URL.revokeObjectURL(a.href);
    });
  });

  // Modal fechar
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
      modalImg.src = '';
      document.body.style.overflow = '';
    }
  });
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal.classList.contains('show')) {
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
      modalImg.src = '';
      document.body.style.overflow = '';
    }
  });
</script>

</body>
</html>
