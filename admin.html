<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Filmes e Séries</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #eee;
    padding: 20px;
  }
  input, select, button, textarea {
    display: block;
    margin: 10px 0;
    padding: 8px;
    width: 300px;
    border-radius: 5px;
    border: none;
  }
  button {
    background-color: #7f5af0;
    color: white;
    cursor: pointer;
  }
  table {
    width: 100%;
    max-width: 800px;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #444;
    padding: 10px;
  }
  th {
    background: #2c2c2c;
  }
  .hidden { display: none; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>Admin - Filmes e Séries</h1>

<form id="formConteudo">
  <input type="hidden" id="docId" />
  <label>Título:
    <input type="text" id="titulo" required />
  </label>
  <label>Categoria:
    <select id="categoria" required>
      <option value="filme">Filme</option>
      <option value="serie">Série</option>
    </select>
  </label>
  <label>Gênero:
    <input type="text" id="genero" required />
  </label>
  <label>Ano:
    <input type="text" id="ano" />
  </label>
  <label>Duração:
    <input type="text" id="duracao" />
  </label>
  <label>Classificação:
    <input type="text" id="classificacao" />
  </label>
  <label>Sinopse:
    <textarea id="sinopse"></textarea>
  </label>
  <label>Link da capa (imagem):
    <input type="url" id="capa" />
  </label>
  <label>Link do trailer (YouTube embed):
    <input type="url" id="trailer" />
  </label>
  <label>Link para assistir:
    <input type="url" id="linkAssistir" />
  </label>
  <button type="submit">Salvar</button>
  <button type="button" id="btnLimpar">Limpar</button>
</form>

<table>
  <thead>
    <tr><th>Título</th><th>Categoria</th><th>Ações</th></tr>
  </thead>
  <tbody id="listaConteudo">
    <tr><td colspan="3">Carregando...</td></tr>
  </tbody>
</table>

<script>
  // Config Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBHIc2E4XwRO5FXo4uHlTQVRArOis73MjE",
    authDomain: "projeto-deus-yato-928.firebaseapp.com",
    projectId: "projeto-deus-yato-928",
    storageBucket: "projeto-deus-yato-928.appspot.com",
    messagingSenderId: "790408726854",
    appId: "1:790408726854:android:e2f0de7b7d5dba96b0fd47"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const form = document.getElementById('formConteudo');
  const lista = document.getElementById('listaConteudo');

  function limparForm() {
    form.reset();
    document.getElementById('docId').value = '';
  }

  // Mostrar todos os conteúdos da coleção 'conteudo'
  function carregarConteudos() {
    lista.innerHTML = '<tr><td colspan="3">Carregando...</td></tr>';
    db.collection('conteudo').orderBy('titulo').get()
      .then(snapshot => {
        if (snapshot.empty) {
          lista.innerHTML = '<tr><td colspan="3">Nenhum conteúdo cadastrado.</td></tr>';
          return;
        }
        lista.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          lista.innerHTML += `
            <tr>
              <td>${data.titulo}</td>
              <td>${data.categoria}</td>
              <td>
                <button onclick="editar('${doc.id}')">Editar</button>
                <button onclick="deletar('${doc.id}')">Deletar</button>
              </td>
            </tr>
          `;
        });
      })
      .catch(() => {
        lista.innerHTML = '<tr><td colspan="3">Erro ao carregar dados.</td></tr>';
      });
  }

  // Editar conteúdo
  function editar(id) {
    db.collection('conteudo').doc(id).get()
      .then(doc => {
        if (!doc.exists) {
          alert('Conteúdo não encontrado');
          return;
        }
        const d = doc.data();
        document.getElementById('docId').value = id;
        document.getElementById('titulo').value = d.titulo || '';
        document.getElementById('categoria').value = d.categoria || 'filme';
        document.getElementById('genero').value = d.genero || '';
        document.getElementById('ano').value = d.ano || '';
        document.getElementById('duracao').value = d.duracao || '';
        document.getElementById('classificacao').value = d.classificacao || '';
        document.getElementById('sinopse').value = d.sinopse || '';
        document.getElementById('capa').value = d.capa || '';
        document.getElementById('trailer').value = d.trailer || '';
        document.getElementById('linkAssistir').value = d.linkAssistir || '';
      })
      .catch(() => alert('Erro ao carregar conteúdo'));
  }

  // Deletar conteúdo
  function deletar(id) {
    if (confirm('Quer deletar este conteúdo?')) {
      db.collection('conteudo').doc(id).delete()
        .then(() => carregarConteudos())
        .catch(() => alert('Erro ao deletar'));
    }
  }

  // Salvar novo ou editar existente
  form.addEventListener('submit', e => {
    e.preventDefault();
    const id = document.getElementById('docId').value;
    const dados = {
      titulo: document.getElementById('titulo').value.trim(),
      categoria: document.getElementById('categoria').value,
      genero: document.getElementById('genero').value.trim(),
      ano: document.getElementById('ano').value.trim(),
      duracao: document.getElementById('duracao').value.trim(),
      classificacao: document.getElementById('classificacao').value.trim(),
      sinopse: document.getElementById('sinopse').value.trim(),
      capa: document.getElementById('capa').value.trim(),
      trailer: document.getElementById('trailer').value.trim(),
      linkAssistir: document.getElementById('linkAssistir').value.trim()
    };

    if (!dados.titulo || !dados.categoria || !dados.genero) {
      alert('Preencha título, categoria e gênero');
      return;
    }

    if (id) {
      db.collection('conteudo').doc(id).set(dados)
        .then(() => {
          alert('Conteúdo atualizado');
          limparForm();
          carregarConteudos();
        })
        .catch(() => alert('Erro ao atualizar'));
    } else {
      db.collection('conteudo').add(dados)
        .then(() => {
          alert('Conteúdo adicionado');
          limparForm();
          carregarConteudos();
        })
        .catch(() => alert('Erro ao adicionar'));
    }
  });

  document.getElementById('btnLimpar').addEventListener('click', limparForm);

  carregarConteudos();

  // Tornar as funções editar e deletar globais para funcionar nos onclick
  window.editar = editar;
  window.deletar = deletar;
</script>

</body>
</html>
